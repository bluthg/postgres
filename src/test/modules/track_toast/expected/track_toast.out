SHOW track_toast;
 track_toast 
-------------
 on
(1 row)

TABLE pg_stat_toast; -- view exists
 schemaname | reloid | attnum | relname | attname | storagemethod | externalized | compressmethod | compressattempts | compresssuccesses | compressedsize | originalsize | total_time 
------------+--------+--------+---------+---------+---------------+--------------+----------------+------------------+-------------------+----------------+--------------+------------
(0 rows)

CREATE TABLE toast_test (cola TEXT, colb TEXT COMPRESSION lz4, colc TEXT , cold TEXT, cole TEXT);
ALTER TABLE toast_test ALTER colc SET STORAGE EXTERNAL;
ALTER TABLE toast_test ALTER cold SET STORAGE MAIN;
ALTER TABLE toast_test ALTER cole SET STORAGE PLAIN;
INSERT INTO toast_test VALUES (repeat(md5('a'),100), repeat(md5('a'),100), repeat(md5('a'),100), repeat(md5('a'),100), repeat(md5('a'),100) );
SELECT pg_sleep(1); -- give the stats collector some time to send the stats upstream
 pg_sleep 
----------
 
(1 row)

SELECT attname
	,storagemethod
	,externalized
	,compressmethod
	,compressattempts
	,compresssuccesses
	,compressedsize < originalsize AS compression_works
	, total_time > 0 AS takes_time 
FROM pg_stat_toast WHERE relname = 'toast_test' ORDER BY attname;
 attname | storagemethod | externalized | compressmethod | compressattempts | compresssuccesses | compression_works | takes_time 
---------+---------------+--------------+----------------+------------------+-------------------+-------------------+------------
 cola    | x             |            1 |                |                1 |                 1 | t                 | t
 colb    | x             |            1 | l              |                1 |                 1 | t                 | t
 colc    | e             |            1 |                |                0 |                 0 | f                 | t
 cold    | m             |            0 |                |                1 |                 1 | t                 | t
(4 rows)

SELECT compressattempts=0 AS external_doesnt_compress FROM pg_stat_toast WHERE relname = 'toast_test' AND storagemethod = 'e';
 external_doesnt_compress 
--------------------------
 t
(1 row)

SELECT externalized=0 AS main_doesnt_externalize FROM pg_stat_toast WHERE relname = 'toast_test' AND storagemethod = 'm';
 main_doesnt_externalize 
-------------------------
 t
(1 row)

DROP TABLE toast_test;
SELECT count(*) FROM pg_stat_toast WHERE relname = 'toast_test';
 count 
-------
     0
(1 row)

